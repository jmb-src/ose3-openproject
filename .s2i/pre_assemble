#!/bin/bash

if [[ -n "${OPENPROJECT_MANAGED_REPOS}" ]]; then
    ln -snf /tmp/src/config/configuration.yml /opt/app-root/etc/configuration.yml
fi
# run bundle to generate lockfile or else build
# will fail when bundle is called with --deployment
# this is mainly because plugins are set with
# environment variables in Gemfile.plugins
cd /tmp/src && bundle --path bundle
# delete resulting .bundle/cache or else there is
# a conflict with /tmp/src/.bundle/config
# when copying in assemble script
rm -rf /opt/app-root/src/.bundle
